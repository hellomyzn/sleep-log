"""test csv sleep repository"""
#########################################################
# Builtin packages
#########################################################
import csv

#########################################################
# 3rd party packages
#########################################################
# (None)

#########################################################
# Own packages
#########################################################
from repositories import CsvBaseRepository
from common.config import Config
from utils.helper import json_load

CONFIG = Config().config

PATH = CONFIG["TEST"]["CSV_SLEEP"]
PATH_KEYS_SLEEP = CONFIG["KEYS_SLEEP"]["SLEEP"]
KEYS = json_load(PATH_KEYS_SLEEP)["keys"]


DATA = [2267,13.875,4.125,55.21,21,3231,2023-11-24T08:22:52.000+09:00,2023-11-23T23:44:01.000+09:00,"{'deep_sleep': 96, 'efficiency': 95, 'latency': 83, 'rem_sleep': 100, 'restfulness': 83, 'timing': 70, 'total_sleep': 84}",2023-11-24,5160,90,0,"{'interval': 300.0, 'items': [None, 64.0, 62.0, 62.0, 59.0, 58.0, 58.0, 57.0, 57.0, 57.0, 56.0, 57.0, 56.0, 58.0, 58.0, 58.0, 60.0, 57.0, 56.0, 56.0, 54.0, 52.0, 52.0, 52.0, 52.0, 52.0, 51.0, 52.0, 51.0, 55.0, 54.0, 53.0, 56.0, 54.0, 53.0, 52.0, 52.0, 55.0, 55.0, 57.0, 58.0, 61.0, 60.0, 56.0, 55.0, 53.0, 52.0, 53.0, 51.0, 51.0, 50.0, 51.0, 51.0, 52.0, 52.0, 54.0, 53.0, 54.0, 56.0, 57.0, 56.0, 55.0, 55.0, 55.0, 59.0, 55.0, 54.0, 54.0, 53.0, 53.0, 52.0, 52.0, 52.0, 52.0, 54.0, 54.0, 53.0, 53.0, 54.0, 54.0, 56.0, 56.0, 60.0, 62.0, 57.0, None, 57.0, 54.0, 53.0, 53.0, 53.0, 55.0, 55.0, 56.0, 56.0, 56.0, 56.0, 57.0, 59.0, 63.0, 63.0, None, None, None], 'timestamp': '2023-11-23T23:44:01.000+09:00'}","{'interval': 300.0, 'items': [None, 16.0, 27.0, 19.0, 16.0, 17.0, 20.0, 17.0, 19.0, 21.0, 20.0, 25.0, 21.0, 24.0, 40.0, 13.0, 17.0, 18.0, 21.0, 15.0, 17.0, 17.0, 18.0, 18.0, 18.0, 18.0, 21.0, 20.0, 20.0, 32.0, 29.0, 19.0, 25.0, 25.0, 31.0, 32.0, 29.0, 34.0, 22.0, 18.0, 21.0, 20.0, 22.0, 20.0, 27.0, 25.0, 20.0, 29.0, 22.0, 24.0, 22.0, 20.0, 22.0, 20.0, 22.0, 33.0, 27.0, 26.0, 21.0, 20.0, 19.0, 28.0, 22.0, 29.0, 17.0, 30.0, 20.0, 16.0, 18.0, 18.0, 21.0, 23.0, 21.0, 22.0, 33.0, 29.0, 17.0, 19.0, 19.0, 20.0, 21.0, 28.0, 22.0, 16.0, 21.0, None, 28.0, 25.0, 19.0, 19.0, 22.0, 22.0, 17.0, 17.0, 17.0, 17.0, 18.0, 22.0, 20.0, 20.0, 16.0, None, None, None], 'timestamp': '2023-11-23T23:44:01.000+09:00'}",510,15510,50.0,6300,222111122211111111111111112112211211111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111112232111111311111111111111112211111211112211121111111111211111111111122111111111111111111111111111111111111111111111111111111111111111111111111111111111111111222111112211111111111111112211111111111111111111112112122111111111111111111111111211111111111112211132111111111221111111112111111123211211212121221221211211111112112221111111111111122212111111111111111111111111111111111111111111111111111111111111111111111111111111221111111111111111121111111111222111111111112211111111121211111112111111221111111111111111111111211111112111111111111211111111111111111111111111111111111111111111111111111111111111111111131111321111111111111111111111111111121111111111111111111111211211122121112111221111211111222112111221111211211111222211112221111111121221111111111111111111111111211111111121111111111111111111111111111111111111111111111111111111111111111111111111221111111111312222111222121222212222111122211333233,1,"{'contributors': {'activity_balance': 93, 'body_temperature': 84, 'hrv_balance': 63, 'previous_day_activity': 74, 'previous_night': 98, 'recovery_index': 91, 'resting_heart_rate': 76, 'sleep_balance': 100, 'sleep_regularity': 77}, 'score': 84, 'temperature_deviation': 0.26, 'temperature_trend_deviation': 0.33}",0,7230,239,85,active,v2,15210,0,31131,27900,long_sleep,5,44242111111111233332211111111222222222233333322222222212233333333322222222422222333333322222222222244444,27,540,-959,30172,14251]

class TestCsvSleepRepository(object):
    """test csv sleep repo"""

    def test_all(self):
        """test all"""
        csv_path = PATH

        with open(csv_path, "r", encoding="utf-8", newline="") as f:
            reader = csv.DictReader(f)
            expected_data = [row for row in reader]

        obj = CsvBaseRepository()
        obj.path = csv_path
        actual = obj.all()

        assert actual == expected_data

    def test_add(self, tmp_path):
        """test add"""
        csv_path = tmp_path / "test.csv"
        keys = KEYS

        obj = CsvBaseRepository()
        obj.path = csv_path
        obj.keys = keys
        obj.add(DATA)

